# Script Syntax
This document should serve to define the syntax that will b parsed by the script parser. It will a bit rambl-y while I get my thoughts down. 
Note: use semi colons for all floats

## Header
This section of the document will identify basic global parameters:
- (User) name [string]: Name of the user
- Lecture Name [string]: The name of the lecture, and the name of the output video (in .mp4 format)
- HeyGen API key [string]: The HeyGen API key that will be used for the requests.
- Default Avatar ID [string]: The identifying id of the avatar to be used by default. 
- Default Voice ID [string]: The id of the voice to be used by default.
- Slides [list[string]]: A list of links to the images to be used as slide backgrounds. They will be used sequentially unless overwritten.
- Default Composition: The type of clip the script will generate for every clip unless overridden. If not specified, will default to Heygen Picture in Picture.
- Default Transition: The type of transition the script will generate between clips unless overridden. If not specified, will default to Fade in.

Most of the parameters here are obvious. I'm not going to clarify how a name works. Having said that, there are things that require clarification. Notably, I must clarify the composition and transition.

## Body
The body is simple. write text. Broadly speaking, each paragraph represents a new clip, which means a new slide. Newlines with no transition information represent a default transition, as do transition commands with no parameters. Paragraphs with no composition information represent a default composition, and composition commands invoked mid paragraph imply a concatenation transition between the two sections of the scene (concatenation means no transition, just a sudden change). Transition commands mid-paragraph work the same way as if they had been called with a new line.

### Transition
Transitions are relatively simple. I will say transitions are invoked with opening and closing "{}". That is, an empty {} indicates a default transition with its default parameters. Inside I will use key-value pairs. Every key-value in the {} overwrites the corresponding key in the default. A transition has quite simple parameters. It has a type and a type and a duration (in seconds).

- type [enum[str]]: The type of transition. I will support all of the transitions supported by FFMPEG's [xfade command](https://trac.ffmpeg.org/wiki/Xfade). In addition I will support concat, which means no transition. Concat needs no duration value
- duration [float]: The duration of the transition. In seconds.

Since there are only two parameters in a command and they are different types, I will accept arguments separated by a comma in any order. Thus, the following are all equivalent:

- {type: fade, duration: 5}
- {type: fade, duration: 5.0}
- {type: fade, 5}
- {type: fade, 5.0}
- {5, fade}
- {5.0, fade}
- {fade, 5}

The recommended from is in key-value pair format. I personally will probably default to the last format for simplicity.

### Avatar
As of v0.05 the avatar-specific parameters will be in an avatar command. The delimiters for the avatar command will be (). The avatar-specific parameters are about the placement of the avatar in any clip generated by heygen and they are:

- id [str]: the avatar id for this clip

- voice_id [str]: the id for the voice of the clip

- position: [tuple[float,float]], [0,1];[0,1]: where the avatar is in its video. It refers to the position of the middle of the avatar in the heygen canvas. Use 0;0 as top left and 1;1 as bottom right. it is x;y.

- scale: [float] (0;2]: how big the avatar is.

- style: [enum] normal, closeUp or circle. Basically how the avatar is presented in its own video

- cbc [str]: rgb color string for the background of the circle around the (if it exists). If this is populated but circle style is not used, it is ignored

- bc [str]: rgb colors string for the background of the avatar clip. if the composition information doesn't require this it will be ignored.

### Composition
Composition refers to how a particular clip is constructed. Composition commands are triggered with [] and inside use key-value pairs to override defaults. 

There are a few compositions that I wish to support. Currently I support picture in picture made by heygen and avatar only. I wish to also support non-heygen pip, side by side, avatar-only, and media-only. 

Each of those has parameters that become important as they get picked. 

- HeyGen Pip: 
Avatar position, Avatar Scale, avatar style, Output Dimension, avatar_circle_background (if using circle avatar style)
- Non-Hey Gen Pip: 
Avatar position, Avatar Scale, Slides position, Slide scale, true background, avatar background, output dimension. avatar_circle_background (if using circle avatar style)
- Side-by-Side: avatar position, avatar scale, slides position, slide scale, true background, avatar background, output dimension [avatar width, avatar_side, slides_side], avatar_circle_background (if using circle avatar style)
- Avatar Only: Avatar position, avatar scale, Avatar style, avatar background, true background, avatar_circle_background (if using circle avatar style)
- Media Only: media url

The common attributes that are required are:
- avatar_clip_position [tuple[float;float]]: where the avatar clip is on the larger canvas. unless the composition is side-by-side this is ignored.
- avatar_clip_scale [float]: size of the avatar clip with respect to its original size.
- media position [tuple[float;float]]: where the media is on the larger canvas.
- media scale [float]: how big the inserted media is with respect to its original size.
- scene background [str]: rgb string for the background of a scene
- output dimension[tuple[int,int]]: output dim. defaults to 1280x720 while I have the trial API key
- media-avatar-ratio [float]: how much of the composed clip's width should be occupied by the media and how much by the avatar. media is 1, avatar is represented by this value, so 1+ratio x slides width = output dim width. determines how we cut the avatar up.

The ones that are currently supported are the following: 
- type [enum] what kind of video composition - pip and avatar-only are the currently supported options
- output_dim [tuple[float;float]] output dimensions of the clip - generally 1280x720 for us.
- tbc [string] true background color for side by side. leaves a band above and below the clips that has to be some color
- avatar_position [string] left or right for now. only works for side by side

IGNORE:
- avatar scale [float]: scale of the avatar. [0.0,2.0]
- avatar style [enum]: normal, closeUp or circle
- output dimension [tuple[int, int]]: output dimension in pixels. Defaults to 1280,720 while I have a trial plan. 
- Slides position [tuple[float,float]]: same as avatar_position
- Slides scale: same as avatar scale
- true background: color of overall background. CSS keywords supported along with #XXXXXX style. 
- avatar_background: color of avatar's background if necessary. 
- avatar_width [float]: how wide the side-by-side snippet of the avatar should be. TODO
- avatar_side [enum]: what side the avatar is on, left or right. TODO
- slide_side [enum]: what side the slides should be on. TODO
- media url: url of the media to be displayed. TODO



So scene is defined by type and all of the above parameters. Not all of them matter for all types.


NOTE: as of v0.05 tuples will not use () to indicate that they are tuples. I think that works...